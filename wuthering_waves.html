<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wuthering Waves – Character Tracker</title>

<!-- Bootstrap (alleen grid) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link rel="stylesheet" href="css/style.css">
</head>

<body>

<div class="container-fluid px-4 py-4">
  <h1 class="fw-bold text-white mb-1">Wuthering Waves – Character Tracker</h1>
  <p class="text-white-50 mb-4">
    Resonance & weapons zijn alleen klikbaar als Owned is aangevinkt.
  </p>

  <div id="list" class="row g-4"></div>
</div>

<script src="js/characters.js"></script>

<script>
const KEY = "ww_tracker_final";
const PLACEHOLDER = "assets/wuwa/resonance/placeholder.jpg";

/* ===============================
   STATE
================================ */
function defaultChar(){
  return {
    owned:false,
    level:1,
    chain:0,
    weapon2:false, // alleen wapen 2 togglebaar
    skills:{ basic:1, skill:1, forte:1, liberation:1, outro:1 }
  };
}

function load(){
  const s = localStorage.getItem(KEY);
  const d = s ? JSON.parse(s) : {};
  CHARACTERS.forEach(c=>{
    if(!d[c.id]) d[c.id] = defaultChar();
  });
  save(d);
  return d;
}

function save(d){
  localStorage.setItem(KEY,JSON.stringify(d));
}

function clamp(v,min,max){
  v = Number(v);
  return isNaN(v)?min:Math.max(min,Math.min(max,v));
}

/* ===============================
   RENDER
================================ */
function render(){
  const data = load();
  const list = document.getElementById("list");
  list.innerHTML="";

  CHARACTERS.forEach(c=>{
    const d = data[c.id];
    const owned = d.owned;

    const col = document.createElement("div");
    col.className = "col-12 col-md-6 col-xl-3";

    col.innerHTML = `
      <div class="card">
        <div class="char-header">
          <div class="char-left">
            <img src="${c.image}" class="char-img">

            <div class="chain-icons">
              ${c.icons.map((icon,i)=>`
                <img
                  src="${icon}"
                  class="chain-icon ${d.chain>=i+1?'active':''} ${owned?'clickable':'disabled'}"
                  ${owned?`onclick="setChain('${c.id}',${i+1})"`:''}
                  onerror="this.src='${PLACEHOLDER}'">
              `).join("")}
            </div>
          </div>

          <div class="char-info">
            <div class="char-title">
              <strong>${c.name}</strong>
              <span class="pill">${c.rarity}</span>

              <label class="owned">
                <input type="checkbox" ${owned?'checked':''}
                  onchange="setOwned('${c.id}',this.checked)">
                Owned
              </label>
            </div>

            <div class="mt-2">
              Level
              <input value="${d.level}"
                oninput="setLevel('${c.id}',this.value)">
            </div>

            ${c.weapons ? `
            <div class="weapon-row">
              <img src="${c.weapons[0]}" class="weapon-icon active">
              <img src="${c.weapons[1]}"
                class="weapon-icon ${d.weapon2?'active':''} ${owned?'clickable':'disabled'}"
                ${owned?`onclick="toggleWeapon2('${c.id}')"`:''}>
            </div>` : ``}
          </div>
        </div>

        <hr>

        ${Object.entries(d.skills).map(([k,v])=>`
          <div class="skill-row">
            <span>${k}</span>
            <input value="${v}"
              oninput="setSkill('${c.id}','${k}',this.value)">
          </div>
        `).join("")}
      </div>
    `;
    list.appendChild(col);
  });
}

/* ===============================
   HANDLERS
================================ */
function setOwned(id,val){
  const d=load();
  d[id].owned=val;
  if(!val){
    d[id].chain=0;
    d[id].weapon2=false;
  }
  save(d);
  render();
}

function toggleWeapon2(id){
  const d=load();
  d[id].weapon2=!d[id].weapon2;
  save(d);
  render();
}

function setChain(id,val){
  const d=load();
  d[id].chain=d[id].chain===val?0:val;
  save(d);
  render();
}

function setLevel(id,val){
  const d=load();
  d[id].level=clamp(val,1,90);
  save(d);
}

function setSkill(id,skill,val){
  const d=load();
  d[id].skills[skill]=clamp(val,1,10);
  save(d);
}

render();
</script>

</body>
</html>
